<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>AM Play</title>
  <!-- Tailwind CSS -->
  <script src="https://cdn.tailwindcss.com"></script>
  <!-- Vue 3 -->
  <script src="https://unpkg.com/vue@3/dist/vue.global.js"></script>
  <style>
    /* Progress Bar Styling */
    input[type="range"] {
      appearance: none;
      width: 100%;
      height: 4px;
      background: #444;
      outline: none;
      border-radius: 5px;
    }
    input[type="range"]::-webkit-slider-thumb {
      appearance: none;
      width: 14px;
      height: 14px;
      background: #a855f7;
      border-radius: 50%;
      cursor: pointer;
    }
  </style>
</head>
<body id="app" class="bg-gray-900 text-white h-screen flex items-center justify-center relative">

  <!-- Blurred Background -->
  <div 
    class="absolute inset-0 bg-cover bg-center blur-lg" 
    :style="`background-image: url('${currentSong.cover}');`">
  </div>
  <div class="absolute inset-0 bg-black bg-opacity-50"></div>

  <!-- Vue App -->
  <div class="relative z-10 w-full max-w-md px-4">
    <!-- Album Art -->
    <div class="flex justify-center">
      <img 
        :src="currentSong.cover" 
        alt="Album Cover" 
        class="w-72 h-72 rounded-lg shadow-lg object-cover"
      />
    </div>

    <!-- Song Details -->
    <div class="text-center mt-6">
      <h1 class="text-3xl font-bold">{{ currentSong.title }}</h1>
      <p class="text-gray-400 text-sm mt-2">{{ currentSong.artist }}</p>
    </div>

    <!-- Progress Bar -->
    <div class="mt-6">
      <input 
        type="range" 
        min="0" 
        :max="duration" 
        v-model="currentTime" 
        @input="seekSong"
      />
      <div class="flex justify-between text-xs text-gray-400 mt-1">
        <span>{{ formatTime(currentTime) }}</span>
        <span>{{ formatTime(duration) }}</span>
      </div>
    </div>

    <!-- Music Controls -->
    <div class="flex items-center justify-center gap-8 mt-6">
        <button @click="toggleRepeat" :class="{'text-purple-400': isRepeat}">
        🔁
        </button>
        <button @click="prevSong" class="text-3xl hover:text-purple-400">
        ⏮️
        </button>
        <button
        @click="togglePlay"
        class="bg-purple-500 text-white w-16 h-16 rounded-full flex items-center justify-center hover:bg-purple-600 shadow-lg"
        >
        <span class="text-3xl">{{ isPlaying ? '⏸️' : '▶️' }}</span>
        </button>
        <button @click="nextSong" class="text-3xl hover:text-purple-400">
        ⏭️
        </button>
        <button @click="toggleShuffle" :class="{'text-purple-400': isShuffle}">
        🔀
        </button>
  </div>
  
  </div>

  <!-- Vue Script -->
  <script>
    const { createApp, ref, reactive } = Vue;

        createApp({
            setup() {
                const audioPlayer = ref(new Audio());
                const isPlaying = ref(false);
                const isRepeat = ref(false);
                const isShuffle = ref(false);
                const currentTime = ref(0);
                const duration = ref(0);
                const currentSongIndex = ref(0);

                // Playlist
                const playlist = reactive([
                {
                    title: "Junooniyat",
                    artist: "Akriti Kakar, Shrey Singhal",
                    cover: "https://pagalnew.com/coverimages/Junooniyat-Meet-Bros-500-500.jpg",
                    src: "https://pagalnew.com/128-download/3964", // Google Drive Direct Link
                },
                {
                    title: "Song 2",
                    artist: "Artist 2",
                    cover: "https://via.placeholder.com/400x400",
                    src: "https://www.soundhelix.com/examples/mp3/SoundHelix-Song-2.mp3",
                },
                {
                    title: "Song 3",
                    artist: "Artist 3",
                    cover: "https://via.placeholder.com/400x400",
                    src: "https://www.soundhelix.com/examples/mp3/SoundHelix-Song-3.mp3",
                },
                ]);

                const currentSong = ref(playlist[currentSongIndex.value]);

                const loadSong = () => {
                audioPlayer.value.src = currentSong.value.src;
                audioPlayer.value.load();
                audioPlayer.value.addEventListener("loadedmetadata", () => {
                    duration.value = audioPlayer.value.duration;
                });
                audioPlayer.value.addEventListener("timeupdate", () => {
                    currentTime.value = audioPlayer.value.currentTime;
                });
                audioPlayer.value.addEventListener("ended", () => {
                    nextSong();
                });
                };

                const togglePlay = () => {
                if (isPlaying.value) {
                    audioPlayer.value.pause();
                } else {
                    audioPlayer.value.play().catch((error) => {
                    // Autoplay failed due to restrictions, just log it
                    console.log("Autoplay failed", error);
                    });
                }
                isPlaying.value = !isPlaying.value;
                };

                const nextSong = () => {
                currentSongIndex.value = isShuffle.value
                    ? Math.floor(Math.random() * playlist.length)
                    : (currentSongIndex.value + 1) % playlist.length;
                updateSong();
                };

                const prevSong = () => {
                currentSongIndex.value =
                    (currentSongIndex.value - 1 + playlist.length) % playlist.length;
                updateSong();
                };

                const updateSong = () => {
                currentSong.value = playlist[currentSongIndex.value];
                isPlaying.value = false;
                loadSong();
                };

                const seekSong = () => {
                audioPlayer.value.currentTime = currentTime.value;
                };

                const toggleRepeat = () => {
                isRepeat.value = !isRepeat.value;
                audioPlayer.value.loop = isRepeat.value;
                };

                const toggleShuffle = () => {
                isShuffle.value = !isShuffle.value;
                };

                const formatTime = (time) => {
                const minutes = Math.floor(time / 60);
                const seconds = Math.floor(time % 60);
                return `${minutes}:${seconds < 10 ? "0" : ""}${seconds}`;
                };

                // Initially load the first song
                loadSong();

                return {
                playlist,
                currentSong,
                isPlaying,
                currentTime,
                duration,
                isRepeat,
                isShuffle,
                togglePlay,
                nextSong,
                prevSong,
                seekSong,
                toggleRepeat,
                toggleShuffle,
                formatTime,
                };
            },
            }).mount("#app");
    </script>
</body>
</html>
